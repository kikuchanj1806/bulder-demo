<div class="rp h-100">
  @if (vm$ | async; as vm) {
    <!-- ===== Header (giữ nguyên) ===== -->
    <div class="rp-header">
      @if (!vm.hasSelection || !vm.node) {
        <div class="text-muted small">Chưa chọn node nào.</div>
      } @else {
        <!-- ... giữ nguyên header/actions/scope switch ... -->
          <!-- (dùng đúng code header hiện tại của bạn) -->
      }
    </div>

    <!-- ===== Body ===== -->
    <div class="rp-body">
      @if (vm.hasSelection && vm.node) {
        <!-- ✅ chỉ 1 form, child chỉ render section (không tạo form lồng) -->
        <form [formGroup]="form" class="ins-form" [class.is-readonly]="!vm.canEdit">
          @switch (vm.node.type) {
            @case ('BLOCK') {
              <app-rp-panel-container [vm]="vm" [form]="form"></app-rp-panel-container>
            }
            @case ('LIST') {
              <app-rp-panel-container [vm]="vm" [form]="form"></app-rp-panel-container>
            }
            @case ('GRID') {
              <app-rp-panel-grid [vm]="vm" [form]="form"></app-rp-panel-grid>
            }
            @case ('TEXT') {
              <app-rp-panel-text [vm]="vm" [form]="form"></app-rp-panel-text>
            }
            @case ('IMAGE') {
              <app-rp-panel-image [vm]="vm" [form]="form"></app-rp-panel-image>
            }
            @case ('PRODUCT_CARD') {
              <app-rp-panel-card kind="product" [vm]="vm" [form]="form"></app-rp-panel-card>
            }
            @case ('BLOG_CARD') {
              <app-rp-panel-card kind="blog" [vm]="vm" [form]="form"></app-rp-panel-card>
            }
            @default {
              <div class="text-muted small">Chưa hỗ trợ panel cho type: {{ vm.node.type }}</div>
            }
          }
        </form>
      }
    </div>
  }
</div>
